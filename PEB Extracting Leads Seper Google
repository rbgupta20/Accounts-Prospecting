# =============================
# ğŸ“¦ Install Dependencies
# =============================
!pip install pandas requests

import requests
import pandas as pd
import time

# =============================
# ğŸ”‘ Step 1 â€“ Enter Serper API Key
# =============================
SERPER_API_KEY = "8f098cf5670e17d76c25e44a54afb3854c7c431b"   # â¬… Replace

# =============================
# ğŸ” Step 2 â€“ Search Queries
# =============================
queries = [
    "pre engineered building manufacturers in Maharashtra",
    "pre engineered building manufacturers in Mumbai",
    "pre engineered building manufacturers in Pune",
    "pre engineered building manufacturers in Nagpur",
    "pre engineered building manufacturers in Nashik",
    "pre engineered building manufacturers in Delhi",
    "pre engineered building manufacturers in Rajasthan",
    "pre engineered building manufacturers in Jaipur",
    "pre engineered building manufacturers in Gurgaon",
    "pre engineered building manufacturers in Gujarat",
    "pre engineered building manufacturers in Ahmedabad",
    "pre engineered building manufacturers in Chennai",
    "pre engineered building manufacturers in Bangalore",
    "pre engineered building manufacturers in Karnataka",
    "pre engineered building manufacturers in Hyderabad",
    "pre engineered building manufacturers in Coimbatore",
    "pre engineered building manufacturers in Telangana",
    "pre engineered building manufacturers in Kolkata",
    "pre engineered building manufacturers in UP",
    "pre engineered building manufacturers in Uttar Pradesh",
    "pre engineered building manufacturers in Punjab",
    "pre engineered building manufacturers in Rajkot",
    "PEB manufacturers in Maharashtra",
    "PEB manufacturers in Mumbai",
    "PEB manufacturers in Pune",
    "PEB manufacturers in Nagpur",
    "PEB manufacturers in Nashik",
    "PEB manufacturers in Delhi",
    "PEB manufacturers in Rajasthan",
    "PEB manufacturers in Jaipur",
    "PEB manufacturers in Gurgaon",
    "PEB manufacturers in Gujarat",
    "PEB manufacturers in Ahmedabad",
    "PEB manufacturers in Chennai",
    "PEB manufacturers in Bangalore",
    "PEB manufacturers in Karnataka",
    "PEB manufacturers in Hyderabad",
    "PEB manufacturers in Coimbatore",
    "PEB manufacturers in Telangana",
    "PEB manufacturers in Kolkata",
    "PEB manufacturers in UP",
    "PEB manufacturers in Uttar Pradesh",
    "PEB manufacturers in Punjab",
    "PEB manufacturers in Rajkot"
]

# =============================
# ğŸ” Step 3 â€“ Function to call Serper API
# =============================
def search_serper(query):
    url = "https://google.serper.dev/search"

    payload = {
        "q": query,
        "num": 30  # Serper returns up to 30
    }

    headers = {
        "X-API-KEY": SERPER_API_KEY,
        "Content-Type": "application/json"
    }

    response = requests.post(url, json=payload, headers=headers)
    data = response.json()

    return data.get("organic", [])

# =============================
# ğŸ“Š Step 4 â€“ Collect results
# =============================
all_rows = []

for query in queries:
    print(f"ğŸ” Searching: {query}")
    results = search_serper(query)

    for idx, r in enumerate(results, start=1):
        all_rows.append({
            "query": query,
            "position": idx,
            "title": r.get("title", ""),
            "link": r.get("link", ""),
            "snippet": r.get("snippet", ""),
            "displayed_link": r.get("displayedLink", "")
        })

    time.sleep(1)  # avoid rate limits

# =============================
# ğŸ“ Step 5 â€“ Save to CSV
# =============================
df = pd.DataFrame(all_rows)
df.to_csv("serper_google_results.csv", index=False)

print("âœ… Completed: serper_google_results.csv saved")
df.head()
